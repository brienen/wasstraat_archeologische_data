#!/bin/bash
set -e


echo "Staring script create $FLASK_PGDATABASE"

psql <<-EOSQL
    CREATE TABLE IF NOT EXISTS airflow__extra_conf(
        conf_name  VARCHAR (255) PRIMARY KEY,
        conf_value VARCHAR (255) NOT NULL
    );

    CREATE USER $FLASK_PGUSER WITH
        LOGIN
        NOSUPERUSER
        NOCREATEDB
        NOCREATEROLE
        NOINHERIT
        NOREPLICATION
        PASSWORD '$FLASK_PGPASSWORD';

    CREATE DATABASE $FLASK_PGDATABASE;
    GRANT ALL PRIVILEGES ON DATABASE $FLASK_PGDATABASE TO $FLASK_PGUSER;
EOSQL

psql -v ON_ERROR_STOP=1 -d $FLASK_PGDATABASE <<-EOSQL
    CREATE EXTENSION postgis;
    CREATE EXTENSION postgis_raster;
    CREATE EXTENSION postgis_topology;
    CREATE EXTENSION postgis_sfcgal;
    CREATE EXTENSION fuzzystrmatch;
    CREATE EXTENSION address_standardizer;
    CREATE EXTENSION address_standardizer_data_us;
    CREATE EXTENSION postgis_tiger_geocoder;
EOSQL



